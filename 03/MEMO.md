# 3日目

やけに内容が多くなったので各章でやってることを大雑把にメモ。正直本と参考サイトでやってることが違うような気がする。

### harib01a
IPLがディスクのセクタ1に入っているので、セクタ2をメモリの0x0820に読み込む。

### harib01b
JNC(Jump if Not Carry)でエラーを判断し5回以上トライして駄目だったら終了する。

### harib01c
18回繰り返して18セクタまで読み込む。ESにアドレスを、CLに読み込むセクタをどんどん足してく。

### harib01d
18セクタまで読み込んだらヘッダを変えて(0or1)もう一度読み込んで、その後シリンダを変えて10シリンダまで読み込む。  
Ci-Hj-Sk(シリンダ,ヘッダ,セクタ)はそれぞれCH,DH,CLレジスタが対応している。

### harib01e
作ったフロッピーのディスクイメージにアセンブルされたharibote.sysを書き込む？
edimg.exeの詳細は[tools/edimg](http://hrb.osask.jp/wiki/?tools/edimg)に書いてある様子。

### harib01f
前回は書き込んだだけなので実際にharibote.sysを実行してみる。

### harib01g
haribote.sysから画面を真っ暗にしてみる。

### harib01h
画面の設定の他にも色数や解像度(X,Y)、VRAMの開始アドレスをメモリに書き込んでおく。
キーボードのLED状態は取得するだけで何もしないのでよく分からない。メモらしいのでそのうち使う？

### harib01i
haribote.nas -> asmhead.nas  
C言語で書かれた部分を読み込む解説は後でするとのこと。0x00280000にmemcpyしてる？

### harib01j
C言語だけではHLTが使えないのでアセンブラで関数を作ってCで呼び出す。
_関数名で関数定義するとC言語で関数名で呼び出せるようになる？

----------

〜参考〜
[OS自作入門 onLinux 3日目](http://cyberbird.indiesj.com/x86%E3%80%80os%E8%87%AA%E4%BD%9C%E5%85%A5%E9%96%80/os%E8%87%AA%E4%BD%9C%E5%85%A5%E9%96%80%20onlinux%203%E6%97%A5%E7%9B%AE)
